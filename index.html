<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UIU Grading Calculator (UIUGC)</title>
  <style>
    /* Same CSS as provided before (unchanged) */
    /* KEEP ALL PREVIOUS CSS HERE */
  </style>
</head>
<body>
  <h1>UIU Grading Calculator (UIUGC)</h1>

  <!-- Current CGPA -->
  <div class="cgpa-section">
    <h3>Current Academic Status</h3>
    <label>Total Completed Credits (excluding this semester):</label>
    <input type="number" id="completedCredits" min="0" step="0.5" placeholder="Enter your total completed credits" />

    <label>Current CGPA:</label>
    <input type="number" id="currentCGPA" min="0" max="4.00" step="0.01" placeholder="Enter your current CGPA" />
  </div>

  <!-- Add Course -->
  <div class="course">
    <h3>Add New Course</h3>
    <label>Credit Hours:</label>
    <input type="number" id="credit" min="0" step="0.5" required placeholder="e.g., 3.0" />

    <label>Grade:</label>
    <select id="grade" required>
      <option value="">Select Grade</option>
      <option value="A">A (4.00)</option>
      <option value="A-">A- (3.67)</option>
      <option value="B+">B+ (3.33)</option>
      <option value="B">B (3.00)</option>
      <option value="B-">B- (2.67)</option>
      <option value="C+">C+ (2.33)</option>
      <option value="C">C (2.00)</option>
      <option value="C-">C- (1.67)</option>
      <option value="D+">D+ (1.33)</option>
      <option value="D">D (1.00)</option>
      <option value="F">F (0.00)</option>
    </select>

    <label>Retake? (Optional)</label>
    <select id="retake" onchange="toggleRetakeFields()">
      <option value="no">No</option>
      <option value="yes">Yes</option>
    </select>

    <div id="retakeFields" style="display: none;">
      <label>Previous Grade:</label>
      <select id="previousGrade">
        <option value="">Select Previous Grade</option>
        <option value="A">A (4.00)</option>
        <option value="A-">A- (3.67)</option>
        <option value="B+">B+ (3.33)</option>
        <option value="B">B (3.00)</option>
        <option value="B-">B- (2.67)</option>
        <option value="C+">C+ (2.33)</option>
        <option value="C">C (2.00)</option>
        <option value="C-">C- (1.67)</option>
        <option value="D+">D+ (1.33)</option>
        <option value="D">D (1.00)</option>
        <option value="F">F (0.00)</option>
      </select>
    </div>

    <button onclick="addCourse()">Add Course</button>
  </div>

  <!-- Course List -->
  <div id="courseList" class="course-list">
    <h3>Added Courses</h3>
    <div id="coursesDisplay"></div>
  </div>

  <!-- Calculate -->
  <div class="calculate-section">
    <button onclick="calculateAll()" class="calculate-btn">Calculate Results</button>
    <div id="output"></div>
    <div id="cgpaOutput"></div>
  </div>

  <!-- Creator Section -->
  <div class="creator-section">
    <div class="disclaimer">
      <h4>‚ö†Ô∏è Important Notice</h4>
      <p>This calculator is designed for <strong>UIU (United International University)</strong> grading policies.</p>
      <p>Please verify your university's grading policy before using it for official purposes.</p>
    </div>
    <div class="creator-info">
      <p><strong>Created by:</strong> Shadhin Nandi</p>
      <p><strong>For:</strong> UIU Curricular Grading System</p>
    </div>
  </div>

  <script type="text/javascript">
    const GRADE_MAPPING = {
      'A': 4.00, 'A-': 3.67, 'B+': 3.33, 'B': 3.00, 'B-': 2.67,
      'C+': 2.33, 'C': 2.00, 'C-': 1.67, 'D+': 1.33, 'D': 1.00, 'F': 0.00
    };

    const courses = [];

    function toggleRetakeFields() {
      const retakeValue = document.getElementById('retake').value;
      const retakeFields = document.getElementById('retakeFields');
      const gradeLabel = document.getElementById('grade').previousElementSibling;

      if (retakeValue === 'yes') {
        retakeFields.style.display = 'block';
        gradeLabel.textContent = 'New Grade:';
      } else {
        retakeFields.style.display = 'none';
        gradeLabel.textContent = 'Grade:';
        document.getElementById('previousGrade').value = '';
      }
    }

    function addCourse() {
      const credit = parseFloat(document.getElementById('credit').value);
      const grade = document.getElementById('grade').value;
      const isRetake = document.getElementById('retake').value === 'yes';
      const previousGrade = document.getElementById('previousGrade').value;

      if (isNaN(credit) || credit <= 0 || !grade) {
        alert("Please enter valid credit and grade.");
        return;
      }

      if (isRetake && !previousGrade) {
        alert("Please select the previous grade for retake courses.");
        return;
      }

      const duplicate = courses.find(c => 
        c.credit === credit && c.grade === grade && c.isRetake === isRetake && c.previousGrade === previousGrade
      );
      if (duplicate) {
        alert("This course already exists.");
        return;
      }

      const courseId = Date.now();
      courses.push({
        id: courseId,
        credit,
        grade,
        previousGrade: isRetake ? previousGrade : null,
        gradePoint: GRADE_MAPPING[grade],
        isRetake
      });

      displayCourses();
      clearForm();
    }

    function displayCourses() {
      const displayDiv = document.getElementById('coursesDisplay');
      if (courses.length === 0) {
        displayDiv.innerHTML = '<p style="color: #666; text-align: center;">No courses added yet.</p>';
        return;
      }

      displayDiv.innerHTML = courses.map((course, index) => {
        let courseDisplay;
        if (course.isRetake) {
          const previousPoint = GRADE_MAPPING[course.previousGrade];
          const newPoint = GRADE_MAPPING[course.grade];
          courseDisplay = `<strong>Course ${index + 1}:</strong> ${course.credit} credits<br>
            <span style="color: #dc3545; font-weight: 600;">[Retake]</span> Previous: ${course.previousGrade} (${previousPoint.toFixed(2)}) ‚Üí New: ${course.grade} (${newPoint.toFixed(2)})<br>
            <span style="color: #28a745; font-weight: 600;">Grade Improvement: ${(newPoint - previousPoint).toFixed(2)} points</span>`;
        } else {
          courseDisplay = `<strong>Course ${index + 1}:</strong> ${course.credit} credits, Grade ${course.grade} (${course.gradePoint.toFixed(2)} GPA)`;
        }

        return `
          <div class="course-item">
            <div class="course-info">${courseDisplay}</div>
            <button class="remove-btn" onclick="removeCourse(${course.id})">Remove</button>
          </div>
        `;
      }).join('');
    }

    function clearForm() {
      document.getElementById('credit').value = '';
      document.getElementById('grade').value = '';
      document.getElementById('retake').value = 'no';
      document.getElementById('previousGrade').value = '';
      document.getElementById('retakeFields').style.display = 'none';
      document.getElementById('grade').previousElementSibling.textContent = 'Grade:';
    }

    function removeCourse(courseId) {
      const index = courses.findIndex(course => course.id === courseId);
      if (index > -1) {
        courses.splice(index, 1);
      }
      displayCourses();
    }

    function calculateAll() {
      const completedCredits = parseFloat(document.getElementById('completedCredits').value) || 0;
      const currentCGPA = parseFloat(document.getElementById('currentCGPA').value) || 0;

      if (courses.length === 0) {
        alert("Please add at least one course first.");
        return;
      }

      let semesterCredits = 0, semesterPoints = 0, retakeAdjustment = 0;

      for (const course of courses) {
        if (course.isRetake) {
          if (completedCredits > 0) {
            retakeAdjustment += (GRADE_MAPPING[course.grade] - GRADE_MAPPING[course.previousGrade]) * course.credit;
          } else {
            semesterCredits += course.credit;
            semesterPoints += course.gradePoint * course.credit;
          }
        } else {
          semesterCredits += course.credit;
          semesterPoints += course.gradePoint * course.credit;
        }
      }

      const semesterGPA = semesterCredits === 0 ? 0 : (semesterPoints / semesterCredits).toFixed(2);

      const totalQualityPoints = (currentCGPA * completedCredits) + semesterPoints + retakeAdjustment;
      const totalNewCredits = completedCredits + semesterCredits;

      const newCGPA = totalNewCredits === 0 ? 0 : (totalQualityPoints / totalNewCredits).toFixed(2);

      document.getElementById('output').innerHTML = `<p><strong>üìä Semester GPA:</strong> ${semesterGPA}</p>`;
      document.getElementById('cgpaOutput').innerHTML = `<p><strong>üéì New CGPA:</strong> ${newCGPA}</p>`;
    }
  </script>
</body>
</html>
